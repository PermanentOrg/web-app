<pr-android-app-notify></pr-android-app-notify>
<div class="share-preview-banner">
  <div class="banner-content">
    <a href="/" class="banner-logo-wrapper">
      <img class="banner-logo" src="assets/img/logo/sideways_logo.png" />
    </a>
    <div class="banner-buttons">
      @if (archive) {
        <div
          class="banner-archive-thumb"
          prBgImage
          [bgSrc]="archive.thumbURL200"
          (click)="onArchiveThumbClick()"
          [cover]="true"
        ></div>
      }
      @if (!isLoggedIn) {
        <button
          class="btn btn-wordpress"
          (click)="navToAuth()"
          >
          {{ isRelationshipShare ? 'Log In' : 'Sign Up' }}
        </button>
      }
      @if (isLoggedIn) {
        <button
          class="btn btn-wordpress"
          (click)="onMyAccountClick()"
          >
          My Archive
        </button>
      }
    </div>
  </div>
</div>
<pr-announcement></pr-announcement>
@if (shareArchive) {
  <div class="share-preview-archive">
    <div
      class="share-preview-archive-thumb"
      prBgImage
      [bgSrc]="shareArchive.thumbURL200"
    ></div>
    <span>
      <strong>{{ displayName }}</strong
        ><br />
        Shared by
        {{
        account && shareAccount.accountId === account.accountId
        ? 'you'
        : shareAccount.fullName
        }}<br />
        @if (shareArchive.fullName) {
          <em class="share-preview-archive-name"
            >From the <strong>{{ shareArchive.fullName }}</strong> Archive</em
            >
          }
        </span>
        @if (hasAccess) {
          <div class="share-preview-archive-buttons">
            <button class="btn btn-primary" (click)="onViewShareClick()">
              {{
              (sharePreviewVO.ShareVO
              ? sharePreviewVO.ShareVO.accessRole
              : sharePreviewVO.accessRole || 'access.role.owner'
              ) | shareActionLabel
              }}
            </button>
            @if (canShare || isLinkShare) {
              <button
                class="btn btn-primary"
                (click)="onShareShareClick()"
                >
                Share
              </button>
            }
          </div>
        }
      </div>
    }
    <div class="share-preview-content-breadcrumbs">
      <pr-breadcrumbs
        (breadcrumbClicked)="goToFolderFromBreadcrumb($event)"
      ></pr-breadcrumbs>
    </div>
    <div class="share-preview-content" [ngClass]="{ navigating: isNavigating }">
      @if (ephemeralFolder !== null) {
        <pr-file-list
          [ephemeralFolder]="ephemeralFolder"
          (itemClicked)="showFolder($event)"
        ></pr-file-list>
      } @else {
        <router-outlet
          (activate)="subscribeToItemClicks($event)"
          (deactivate)="unsubscribeFromItemClicks()"
        ></router-outlet>
      }
    </div>
    @if (!hasAccess && isLoggedIn && !isUnlistedShare) {
      <div
        class="share-preview-cover from-bottom"
        [ngClass]="{ 'share-preview-cover-visible': showCover }"
        (click)="toggleCover()"
        >
        <div class="share-preview-cover-content" (click)="stopPropagation($event)">
          @if (!isLoggedIn) {
            <p>
              @if (isInvite || (isLinkShare && formType === 0)) {
                <span
                  >Get full access to {{ shareAccount.fullName }}'s shared item and claim
                  your free gigabyte of storage.</span
                  >
                }
                @if (isLinkShare && formType === 2) {
                  <span
                    >Get full access to {{ shareAccount.fullName }}'s shared item.</span
                    >
                  }
                  @if (isRelationshipShare) {
                    <span
                      >To view or edit this content, log in to Permanent.org.</span
                      >
                    }
                  </p>
                }
                @if (isLoggedIn && !isUnlistedShare) {
                  <p>
                    @if (isLinkShare && !hasRequested) {
                      <span
                        >Request full access from {{ shareAccount.fullName }}.</span
                        >
                      }
                      @if (isLinkShare && hasRequested) {
                        <span
                          >Your request is awaiting approval from
                          {{ shareAccount.fullName }}.</span
                          >
                        }
                        @if (isRelationshipShare) {
                          <span
                            >To view or edit this content, switch archives or accounts.</span
                            >
                          }
                        </p>
                      }
                      @if (!isLoggedIn) {
                        <div class="share-preview-form-wrapper">
                          <div class="share-preview-form">
                            <!-- regular signup form -->
                            @if (formType === 0) {
                              <form
                                [formGroup]="signupForm"
                                (ngSubmit)="onSignupSubmit(signupForm.value)"
                                >
                                <div class="input-group-vertical">
                                  <pr-form-input
                                    fieldName="name"
                                    placeholder="Full name"
                                    [control]="signupForm.controls['name']"
							[config]="{
								autocomplete: 'name',
								autocorrect: 'off',
								autocapitalize: 'yes',
								spellcheck: 'off'
							}"
                                  ></pr-form-input>
                                  <pr-form-input
                                    fieldName="email"
                                    placeholder="Email"
                                    [control]="signupForm.controls['email']"
							[config]="{
								autocomplete: 'email',
								autocorrect: 'off',
								autocapitalize: 'off',
								spellcheck: 'off'
							}"
                                  ></pr-form-input>
                                  <pr-form-input
                                    type="password"
                                    fieldName="password"
                                    placeholder="Password (min. 8 chars)"
                                    [control]="signupForm.controls['password']"
							[config]="{
								autocomplete: 'new-password',
								autocorrect: 'off',
								autocapitalize: 'off',
								spellcheck: 'off'
							}"
                                  ></pr-form-input>
                                </div>
                                <button
                                  type="submit"
                                  class="btn btn-alternate"
                                  [disabled]="waiting || signupForm.invalid"
                                  >
                                  Sign up
                                </button>
                                <a tabindex="0" (click)="formType = 2">Already have an account?</a>
                              </form>
                            }
                            <!-- short signup for invite form -->
                            @if (formType === 1) {
                              <form
                                [formGroup]="signupForm"
                                (ngSubmit)="onSignupSubmit(signupForm.value)"
                                >
                                <div class="input-group-vertical">
                                  <pr-form-input
                                    fieldName="email"
                                    placeholder="Email"
                                    [control]="signupForm.controls['email']"
                                    [config]="{ readOnly: true }"
                                  ></pr-form-input>
                                  <pr-form-input
                                    type="text"
                                    fieldName="name"
                                    placeholder="Full name"
                                    [control]="signupForm.controls['name']"
							[config]="{
								autocomplete: 'name',
								autocorrect: 'off',
								autocapitalize: 'yes',
								spellcheck: 'off'
							}"
                                  ></pr-form-input>
                                  <pr-form-input
                                    type="password"
                                    fieldName="password"
                                    placeholder="Password (min. 8 chars)"
                                    [control]="signupForm.controls['password']"
							[config]="{
								autocomplete: 'new-password',
								autocorrect: 'off',
								autocapitalize: 'off',
								spellcheck: 'off'
							}"
                                  ></pr-form-input>
                                </div>
                                <button
                                  type="submit"
                                  class="btn btn-alternate"
                                  [disabled]="waiting || signupForm.invalid"
                                  >
                                  Sign up
                                </button>
                              </form>
                            }
                            <!-- login form -->
                            @if (formType === 2) {
                              <form
                                [formGroup]="loginForm"
                                (ngSubmit)="onLoginSubmit(loginForm.value)"
                                >
                                <div class="input-group-vertical">
                                  <pr-form-input
                                    fieldName="email"
                                    placeholder="Email"
                                    [control]="loginForm.controls['email']"
							[config]="{
								autocomplete: 'email',
								autocorrect: 'off',
								autocapitalize: 'off',
								spellcheck: 'off'
							}"
                                  ></pr-form-input>
                                  <pr-form-input
                                    type="password"
                                    fieldName="password"
                                    placeholder="Password (min. 8 chars)"
                                    [control]="loginForm.controls['password']"
							[config]="{
								autocomplete: 'new-password',
								autocorrect: 'off',
								autocapitalize: 'off',
								spellcheck: 'off'
							}"
                                  ></pr-form-input>
                                </div>
                                <button
                                  type="submit"
                                  class="btn btn-alternate"
                                  [disabled]="waiting || loginForm.invalid"
                                  >
                                  Log in
                                </button>
                                @if (!isRelationshipShare) {
                                  <a tabindex="0" (click)="formType = 0"
                                    >Need to sign up?</a
                                    >
                                  }
                                </form>
                              }
                            </div>
                          </div>
                        }
                        @if (isLoggedIn && !isUnlistedShare) {
                          <div
                            class="share-preview-cover-buttons"
                            (click)="stopPropagation($event)"
                            >
                            @if (isLinkShare) {
                              <button
                                class="btn btn-wordpress"
                                (click)="onRequestAccessClick()"
                                [disabled]="waiting || hasRequested"
                                >
                                @if (hasRequested) {
                                  Access Requested
                                } @else {
                                  @if (isAutoApprove) {
                                    Accept Share
                                  } @else {
                                    Request Access
                                  }
                                }
                              </button>
                            }
                            @if (isRelationshipShare) {
                              <button
                                class="btn btn-wordpress"
                                (click)="onArchiveThumbClick()"
                                >
                                Switch Archive
                              </button>
                            }
                          </div>
                        }
                      </div>
                    </div>
                  }
                  @if (!hasAccess && isLoggedIn && !isUnlistedShare) {
                    <div
                      class="share-preview-footer"
                      [ngClass]="{ 'share-preview-footer-visible': !showCover }"
                      >
                      <div class="share-preview-footer-content">
                        <span (click)="toggleCover()">
                          @if (isLinkShare && !hasRequested) {
                            <strong>
                              @if (isAutoApprove) {
                                Accept and view the share in your archive.
                              } @else {
                                Request full access from {{ shareAccount.fullName }}.
                              }
                            </strong>
                          }
                          @if (isLinkShare && hasRequested) {
                            <strong
                              >Your request is awaiting approval from
                              {{ shareAccount.fullName }}.</strong
                              >
                            }
                            @if (isRelationshipShare) {
                              <strong
                                >Your current archive does not have access to this content. Switch to
                                view or edit.</strong
                                >
                              }
                              @if (isLinkShare) {
                                <div>
                                  @if (isLinkShare) {
                                    <button
                                      class="btn btn-alternate"
                                      (click)="onRequestAccessClick()"
                                      [disabled]="waiting || hasRequested"
                                      >
                                      @if (hasRequested) {
                                        Access Requested
                                      } @else {
                                        @if (isAutoApprove) {
                                          Accept Share
                                        } @else {
                                          Request Access
                                        }
                                      }
                                    </button>
                                  }
                                </div>
                              }
                            </span>
                          </div>
                        </div>
                      }
                      @if (!isLoggedIn && !isUnlistedShare) {
                        <pr-share-preview-footer
                          [accountUserName]="shareAccount.fullName"
                          [closeEvent]="hideBannerObservable"
                        ></pr-share-preview-footer>
                      }
                      <pr-prompt></pr-prompt>
